## JPA

### ORM이란 ?
> 애플리케이션의 클래스와 SQL 데이터베이스 테이블 간에 , 맵핑정보를 포함한  메타데이터를 기술하여 
> 자바 애플리케이션의 객체를 SQL데이터베이스에 자동으로 (또 깨끗하게) 영속화 해주는 기술이다.


### ORM 을 사용해야하는 이유 ?
> JDBC기반의 코딩은 너무 코드가 장황하고 , 불필요한 중복코드가많다.
> 도메인 모델 기반으로 코딩을 할경우 , 이를해결하고 , 객체지향 프로그래밍 , 각종디자인패턴 , 코드재사용 , 비지니스로직에 집중 및 테스트가 편리해진다.

### ORM을 사용할 경우 장점 ? 
1. 생산성
2. 유지보수성
3. 성능
4. 벤더 독립성

### 단점 ? 
- 학습비용이 크다.


### ORM 패러다임의 불일치 ?
- 객체를 릴레이션에 매핑하려니 발생하는 문제와 해결방법들 

1. 밀도 문제

| 객체 | 릴레이션 | 
| :---|:---|
|다양한 크기의 객체를 만들기쉬|테이블|
|커스텀한타입을 가질수있음 | 기본데이터타입|

> 커스텀한 데이터타입을 만들었을떄 ORM이 릴레이션과 매핑문제를 해결해준다.

2. 서브타입 문제

- 객체는 상속구조를 만들기가쉽다.
- 테이블은 상속구조가 없다.
- 다형성
- 다형성을 표현할 방법이없다.

3.식별성 문제

- 레퍼런스 동일성
- 주키
- 인스턴스의 동일성 equals
> 식별성문제를 ORM이 해결해준다.
4. 관계문제

- 객체에서는 레퍼런스 관계로 표현된다.
- 근본적으로 '방향' 이 존재한다.
- 다대다 관계를 가질 수 있다.

- 외래키로 관계를 표현한다.
- 방향이라는 의미가없다, join으로 인해 아무방향이나 다 가져올수있다.
- 다대다 관계가없으며 조인테이블이나 링크테이블이 필요하다.
> 이러한 매핑문제를 ORM이 해결해준다.
> 링크테이블을 자동적으로 생성해주는등..

5. 데이터 네비게이션문제

- 객체에서는 레퍼런스를 이용하여 다른객체로 이동이 가능하다.
- 콜랙션을 순회할 수도있다.

- 하지만 위의 방식은 릴레이션에서는 매우 비효율적이다.
- 요청을 적게 할 수록 효율이 좋기때문에 JOIN을 사용한다.
- 하지만 한번에 많은 수의 데이터를 가져오더라도 문제가된다.
- LAZY LOADING 방식을 사용하려고해도 문제이다. N+1 SELECT 
> JDBC 커넥션을 사용하는것이 비용자체가 크다.
> 가급적이면 한 트랜잭션에서 요청을 처리하는것이 성능면에서 유리하다.


### JPA 자동설정 ?
- HibernateJPAAutoConfiguration
- 클래스에서 PlatformTransactionManager, EntityManagerFactoryBean등 을 자동으로 주입해준다.
- 그외에도 JPA를 사용하기 위한 다양한 설정들을 자동으로해준다.

> createClob() 이라는 경고메시지가 발생할경우 (postgres)
> 아래의 설정을추가하면 경고메시지가 사라진다.
> 해당 메시지가 나는이유 ? 
- 사용하는 드라이버가 createClob을 구현하지않았기때문에 발생함.
- spring.jpa.properties.hibernate.jdbc.lob.non_context_creation=true


### 엔티티 매핑
> @Entity
- 엔티티는 객체지향프로그래밍에서의 이름이다.
- 보통 클래스와 동일한 이름을 사용하기때문에 변경하지않는다.
- 엔티티의 이름은 JQL에서 사용한다.

> @Table
- 릴레이션 (데이터베이스) 에서의 이름이다. [실제 테이블의 이름]
- @Entity의 이름이 기본값이다.
- 테이블의 이름은 SQL에서 사용된다.

> @Id
- 엔티티의 주 키를 매핑할때 사용한다.
- 자바의 모든 primitive타입과 , 래퍼타입을 사용할 수 있다.
- Date, BigDecimal, BigInteger도 사용이 가능하다.
- 복합키를 만드는 매핑방법도 존재한다.

> @GeneratedValue
- 주키의 생성 방법을 매핑하는 애노테이션이다.
- 생성전략과 , 생성기를 설정할 수 있다.
    - 기본전략은 AUTO : 사용하는 디비에 따라 적절한 전략을 선택한다.
    - TABLE, SEQUENCE, IDENTITY중 하나 ..

> @Column
- 테이블의 컬럼을 매핑할때 사용한다.
- 엔티티 클래스의 필드에 사용한다.
- unique. nullable, length,columnDefiniton... 등 다양한 옵션을 제공한다.

> @Temporal
- 현재 JPA2.1까지는 Date, Calender한다. 2.2 이상부터 LocalDate지원..
- Custom한 타입을 매핑하는 방법도 존재한다. (Converter)

> @Transient
- 컬럼과 매핑하고싶지않은 필드에 사용한다.


